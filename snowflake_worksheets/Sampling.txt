CREATE OR REPLACE TRANSIENT DATABASE SAMPLING_DB;

CREATE OR REPLACE TABLE CUSTOMER_ADDRESS_SAMPLE_5
AS 
SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.CUSTOMER_ADDRESS 
SAMPLE ROW (5) SEED(2);

select count(*) from CUSTOMER_ADDRESS_SAMPLE_5;

CREATE OR REPLACE TABLE CUSTOMER_ADDRESS_SAMPLE_1
AS 
SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.CUSTOMER
SAMPLE SYSTEM (1) SEED(2);

select count(*) from CUSTOMER_ADDRESS_SAMPLE_1;



SHARE
----
SHOW SHARES;

// Create a share object
CREATE OR REPLACE SHARE ORDERS_SHARE;

---- Setup Grants ----

// Grant usage on database
GRANT USAGE ON DATABASE EXERCISE_DB TO SHARE ORDERS_SHARE; 
// Grant usage on schema
GRANT USAGE ON SCHEMA EXERCISE_DB.PUBLIC TO SHARE ORDERS_SHARE; 
// Grant SELECT on table
GRANT SELECT ON TABLE EXERCISE_DB.PUBLIC.CUSTOMERS TO SHARE ORDERS_SHARE; 

// Validate Grants
SHOW GRANTS TO SHARE ORDERS_SHARE;


---- Add Consumer Account ----
//Using Snowflake ID account
ALTER SHARE ORDERS_SHARE ADD ACCOUNT=<consumer-account-id>;
//Using a reader account for a non Snowflake user
CREATE MANAGED ACCOUNT tech_joy_account
ADMIN_NAME = tech_joy_admin,
ADMIN_PASSWORD = 'set-pwfDDf51951fffffffffffd',
TYPE = READER;

// Make sure to have selected the role of accountadmin

// Show accounts
SHOW MANAGED ACCOUNTS;

-- Share the data -- 
ALTER SHARE ORDERS_SHARE 
ADD ACCOUNT = HO04845//<reader-account-id>
SHARE_RESTRICTIONS=false;
